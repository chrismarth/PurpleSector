"use strict";(self.webpackChunkpurple_sector=self.webpackChunkpurple_sector||[]).push([[574],{3834:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"ops/deployment","title":"Deployment","description":"This page describes common deployment patterns for Purple Sector services: PM2, systemd, and Docker.","source":"@site/docs/ops/deployment.md","sourceDirName":"ops","slug":"/ops/deployment","permalink":"/PurpleSector/ops/deployment","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"userGuide","previous":{"title":"Running the Stack","permalink":"/PurpleSector/ops/running-stack"},"next":{"title":"Monitoring","permalink":"/PurpleSector/ops/monitoring"}}');var l=s(4848),i=s(8453);const o={},c="Deployment",t={},d=[{value:"PM2 Deployment",id:"pm2-deployment",level:2},{value:"Install PM2",id:"install-pm2",level:3},{value:"Start Services",id:"start-services",level:3},{value:"Monitor and Logs",id:"monitor-and-logs",level:3},{value:"Restart and Lifecycle",id:"restart-and-lifecycle",level:3},{value:"Systemd Deployment",id:"systemd-deployment",level:2},{value:"Docker Deployment",id:"docker-deployment",level:2},{value:"Environment Configuration",id:"environment-configuration",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,l.jsx)(n.p,{children:"This page describes common deployment patterns for Purple Sector services: PM2, systemd, and Docker."}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"These examples focus on the backend services (Kafka\u2013WebSocket bridge, collectors, DB consumer). Deploying the Next.js app can follow your usual Node hosting or containerization strategy."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"pm2-deployment",children:"PM2 Deployment"}),"\n",(0,l.jsx)(n.p,{children:"PM2 is convenient for running Node services in the background on a single host."}),"\n",(0,l.jsx)(n.h3,{id:"install-pm2",children:"Install PM2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -g pm2\n"})}),"\n",(0,l.jsx)(n.h3,{id:"start-services",children:"Start Services"}),"\n",(0,l.jsxs)(n.p,{children:["Use the provided ",(0,l.jsx)(n.code,{children:"ecosystem.config.js"})," to run bridge and collectors:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pm2 start ecosystem.config.js\n"})}),"\n",(0,l.jsx)(n.p,{children:"Typical services include:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kafka-bridge"})," \u2013 Kafka\u2192WebSocket bridge."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kafka-db-consumer"})," \u2013 Kafka\u2192DB consumer."]}),"\n",(0,l.jsxs)(n.li,{children:["Collectors such as ",(0,l.jsx)(n.code,{children:"acc-collector"})," or demo collectors."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"monitor-and-logs",children:"Monitor and Logs"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pm2 monit          # Live dashboard\npm2 logs           # All logs\npm2 logs kafka-bridge\npm2 logs acc-collector\n"})}),"\n",(0,l.jsx)(n.h3,{id:"restart-and-lifecycle",children:"Restart and Lifecycle"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"pm2 restart all\npm2 stop all\npm2 delete all\n"})}),"\n",(0,l.jsx)(n.h2,{id:"systemd-deployment",children:"Systemd Deployment"}),"\n",(0,l.jsx)(n.p,{children:"For production environments, you can use systemd service units to run core processes."}),"\n",(0,l.jsx)(n.p,{children:"Example systemd steps (high level):"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["Create service files under ",(0,l.jsx)(n.code,{children:"/etc/systemd/system/"}),", e.g. ",(0,l.jsx)(n.code,{children:"kafka-bridge.service"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Enable and start services:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable kafka-bridge\nsudo systemctl start kafka-bridge\nsudo systemctl status kafka-bridge\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Systemd will manage restarts and startup on boot; PM2 can still be used inside a systemd unit if desired."}),"\n",(0,l.jsx)(n.h2,{id:"docker-deployment",children:"Docker Deployment"}),"\n",(0,l.jsx)(n.p,{children:"You can containerize the services into a Docker image, for example:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Build image\ndocker build -t purple-sector-services .\n\n# Run bridge\ndocker run -d \\\n  --name kafka-bridge \\\n  -p 8080:8080 \\\n  -e KAFKA_BROKERS=kafka:9092 \\\n  purple-sector-services \\\n  node services/kafka-websocket-bridge.js\n"})}),"\n",(0,l.jsx)(n.p,{children:"You can define additional containers for collectors and the DB consumer, or orchestrate them with Docker Compose or Kubernetes."}),"\n",(0,l.jsx)(n.h2,{id:"environment-configuration",children:"Environment Configuration"}),"\n",(0,l.jsx)(n.p,{children:"Regardless of deployment method, key environment variables include:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Kafka"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"KAFKA_BROKERS"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"KAFKA_CLIENT_ID"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"KAFKA_TOPIC_TELEMETRY"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"WebSocket Bridge"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"WS_PORT"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"WS_HOST"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Database Consumer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"DATABASE_URL"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Logging"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"LOG_LEVEL"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"LOG_FORMAT"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Refer to ",(0,l.jsx)(n.code,{children:".env.example"})," and the ",(0,l.jsx)(n.code,{children:"@purplesector/config"})," package for full configuration options."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var r=s(6540);const l={},i=r.createContext(l);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);