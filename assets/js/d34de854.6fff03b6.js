"use strict";(self.webpackChunkpurple_sector=self.webpackChunkpurple_sector||[]).push([[100],{6670:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"dev/dev-environment","title":"Development Environment","description":"The development environment runs the full Kafka-based telemetry pipeline with demo data, so you can work on Purple Sector without having Assetto Corsa or ACC running.","source":"@site/docs/dev/dev-environment.md","sourceDirName":"dev","slug":"/dev/dev-environment","permalink":"/PurpleSector/dev/dev-environment","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"userGuide","previous":{"title":"Monorepo Structure","permalink":"/PurpleSector/dev/monorepo-structure"},"next":{"title":"App Shell Architecture","permalink":"/PurpleSector/dev/app-shell"}}');var t=s(4848),i=s(8453);const d={},l="Development Environment",c={},a=[{value:"Overview",id:"overview",level:2},{value:"One-Command Startup",id:"one-command-startup",level:2},{value:"PM2 Process Management",id:"pm2-process-management",level:2},{value:"Checking Status",id:"checking-status",level:3},{value:"Viewing Logs",id:"viewing-logs",level:3},{value:"Restarting Services",id:"restarting-services",level:3},{value:"Manual Startup (Per-Service)",id:"manual-startup-per-service",level:2},{value:"Authentication in Dev",id:"authentication-in-dev",level:2},{value:"Database",id:"database",level:2},{value:"Common Commands",id:"common-commands",level:3},{value:"Starting Fresh",id:"starting-fresh",level:3},{value:"Plugin Schema Merging",id:"plugin-schema-merging",level:2},{value:"First Load Behavior",id:"first-load-behavior",level:2},{value:"Environment Variables",id:"environment-variables",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"development-environment",children:"Development Environment"})}),"\n",(0,t.jsx)(n.p,{children:"The development environment runs the full Kafka-based telemetry pipeline with demo data, so you can work on Purple Sector without having Assetto Corsa or ACC running."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The dev environment is designed for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Rapid iteration on the frontend and services."}),"\n",(0,t.jsx)(n.li,{children:"Testing the full pipeline end-to-end."}),"\n",(0,t.jsx)(n.li,{children:"Debugging collectors, bridge, and DB consumer."}),"\n",(0,t.jsx)(n.li,{children:"Demos without a game client."}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["For basic installation and a one-command startup, see ",(0,t.jsx)(n.strong,{children:"User Guide \u2192 Getting Started"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"one-command-startup",children:"One-Command Startup"}),"\n",(0,t.jsx)(n.p,{children:"The recommended way to start everything is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run dev:start\n"})}),"\n",(0,t.jsx)(n.p,{children:"This will:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Start the Kafka cluster via Docker."}),"\n",(0,t.jsx)(n.li,{children:"Create Kafka topics."}),"\n",(0,t.jsx)(n.li,{children:"Start the Kafka\u2013WebSocket bridge."}),"\n",(0,t.jsx)(n.li,{children:"Start the Kafka\u2192DB consumer."}),"\n",(0,t.jsx)(n.li,{children:"Start the demo collector (publishes sample telemetry)."}),"\n",(0,t.jsx)(n.li,{children:"Start the Next.js frontend."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"After startup, the main access points are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Frontend:"})," ",(0,t.jsx)(n.code,{children:"http://localhost:3000"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Kafka UI (if enabled):"})," typically ",(0,t.jsx)(n.code,{children:"http://localhost:8090"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"WebSocket:"})," ",(0,t.jsx)(n.code,{children:"ws://localhost:8080"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To stop the environment:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Stop services, keep Kafka running\nnpm run dev:stop\n\n# Stop services AND Kafka\nnpm run dev:stop-all\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pm2-process-management",children:"PM2 Process Management"}),"\n",(0,t.jsxs)(n.p,{children:["The dev environment uses PM2 to manage services. The configuration is in ",(0,t.jsx)(n.code,{children:"ecosystem.dev.config.js"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"checking-status",children:"Checking Status"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx pm2 status\n"})}),"\n",(0,t.jsx)(n.p,{children:"Typical services:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"PM2 Name"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"nextjs-dev"})}),(0,t.jsx)(n.td,{children:"Next.js dev server (port 3000)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-bridge-dev"})}),(0,t.jsx)(n.td,{children:"Kafka \u2192 WebSocket bridge"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kafka-db-consumer-dev"})}),(0,t.jsx)(n.td,{children:"Kafka \u2192 DB consumer"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"demo-collector-dev"})}),(0,t.jsx)(n.td,{children:"Demo telemetry publisher"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"viewing-logs",children:"Viewing Logs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx pm2 logs                    # All services\nnpx pm2 logs nextjs-dev         # Just the Next.js server\nnpx pm2 logs kafka-bridge-dev   # Just the bridge\n"})}),"\n",(0,t.jsx)(n.h3,{id:"restarting-services",children:"Restarting Services"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx pm2 restart nextjs-dev\nnpx pm2 restart all\n"})}),"\n",(0,t.jsx)(n.h2,{id:"manual-startup-per-service",children:"Manual Startup (Per-Service)"}),"\n",(0,t.jsx)(n.p,{children:"You can also start components individually, for example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Kafka\ndocker-compose -f docker-compose.kafka.yml up -d\n\n# Kafka topics\nnpm run kafka:setup\n\n# Bridge\nnpm run kafka:bridge\n\n# DB consumer\nnpm run kafka:db-consumer\n\n# Demo collector\nnpm run telemetry:demo-kafka\n\n# Frontend\nnpm run dev\n"})}),"\n",(0,t.jsx)(n.h2,{id:"authentication-in-dev",children:"Authentication in Dev"}),"\n",(0,t.jsx)(n.p,{children:"The dev environment uses stub authentication with two hardcoded users:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Username"}),(0,t.jsx)(n.th,{children:"Role"}),(0,t.jsx)(n.th,{children:"Cookie Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"admin"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ORG_ADMIN"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ps_user=admin"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"user"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"USER"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ps_user=user"})})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["No password is required. The middleware checks the ",(0,t.jsx)(n.code,{children:"ps_user"})," cookie, and the ",(0,t.jsx)(n.code,{children:"AuthProvider"})," fetches ",(0,t.jsx)(n.code,{children:"/api/auth/me"})," to resolve the user object."]}),"\n",(0,t.jsx)(n.h2,{id:"database",children:"Database"}),"\n",(0,t.jsxs)(n.p,{children:["The dev environment uses SQLite by default (",(0,t.jsx)(n.code,{children:'DATABASE_URL="file:./dev.db"'}),")."]}),"\n",(0,t.jsx)(n.h3,{id:"common-commands",children:"Common Commands"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run db:push     # Push schema changes\nnpm run db:reset    # Reset database (destructive)\nnpm run db:studio   # Open Prisma Studio\n"})}),"\n",(0,t.jsx)(n.h3,{id:"starting-fresh",children:"Starting Fresh"}),"\n",(0,t.jsx)(n.p,{children:"If you need a clean slate:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run dev:stop-all\nrm -rf .next/\nnpm run db:reset\nnpm run dev:start\n"})}),"\n",(0,t.jsx)(n.h2,{id:"plugin-schema-merging",children:"Plugin Schema Merging"}),"\n",(0,t.jsxs)(n.p,{children:["If you modify a plugin's ",(0,t.jsx)(n.code,{children:"plugin.prisma"})," file, regenerate the merged schema:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx ts-node scripts/merge-plugin-schemas.ts\nnpm run db:push\n"})}),"\n",(0,t.jsx)(n.h2,{id:"first-load-behavior",children:"First Load Behavior"}),"\n",(0,t.jsxs)(n.p,{children:["On first load after starting the dev server, Next.js compiles pages and API routes on demand. This can take 10\u201330 seconds. The ",(0,t.jsx)(n.code,{children:"AuthProvider"})," has timeout and retry logic to handle slow initial compilation gracefully. If the app shows a spinner for an extended time, wait a moment and then reload."]}),"\n",(0,t.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsxs)(n.p,{children:["Key variables in ",(0,t.jsx)(n.code,{children:".env.local"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DATABASE_URL"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"file:./dev.db"})}),(0,t.jsx)(n.td,{children:"Database connection string"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"OPENAI_API_KEY"})}),(0,t.jsx)(n.td,{children:"\u2014"}),(0,t.jsx)(n.td,{children:"Required for AI analysis and agent"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"WS_PORT"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"8080"})}),(0,t.jsx)(n.td,{children:"WebSocket server port"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TELEMETRY_UDP_PORT"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"9996"})}),(0,t.jsx)(n.td,{children:"AC telemetry UDP port"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.code,{children:".env.example"})," for the full list."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var r=s(6540);const t={},i=r.createContext(t);function d(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);