"use strict";(self.webpackChunkpurple_sector=self.webpackChunkpurple_sector||[]).push([[181],{5388:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>x,frontMatter:()=>t,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"dev/database-and-telemetry","title":"Database and Telemetry","description":"This page describes the database schema, telemetry data model, and how data is persisted in Purple Sector.","source":"@site/docs/dev/database-and-telemetry.md","sourceDirName":"dev","slug":"/dev/database-and-telemetry","permalink":"/PurpleSector/dev/database-and-telemetry","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"userGuide","previous":{"title":"Analysis Panels","permalink":"/PurpleSector/dev/analysis-panels"},"next":{"title":"ACC Telemetry Collectors","permalink":"/PurpleSector/dev/acc-telemetry"}}');var d=s(4848),i=s(8453);const t={},l="Database and Telemetry",c={},h=[{value:"Database Stack",id:"database-stack",level:2},{value:"Core Models",id:"core-models",level:2},{value:"Event",id:"event",level:3},{value:"Session",id:"session",level:3},{value:"Lap",id:"lap",level:3},{value:"TelemetryFrame",id:"telemetryframe",level:3},{value:"Vehicle",id:"vehicle",level:3},{value:"VehicleConfiguration",id:"vehicleconfiguration",level:3},{value:"VehicleSetup",id:"vehiclesetup",level:3},{value:"SavedPlotLayout",id:"savedplotlayout",level:3},{value:"MathTelemetryChannel",id:"mathtelemetrychannel",level:3},{value:"Plugin Models (Agent)",id:"plugin-models-agent",level:2},{value:"Schema Management",id:"schema-management",level:2},{value:"Merging Plugin Schemas",id:"merging-plugin-schemas",level:3},{value:"Common Commands",id:"common-commands",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Telemetry Pipeline",id:"telemetry-pipeline",level:2},{value:"Kafka Transport",id:"kafka-transport",level:3},{value:"Protobuf Encoding",id:"protobuf-encoding",level:3},{value:"Per-User Topics",id:"per-user-topics",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"database-and-telemetry",children:"Database and Telemetry"})}),"\n",(0,d.jsx)(n.p,{children:"This page describes the database schema, telemetry data model, and how data is persisted in Purple Sector."}),"\n",(0,d.jsx)(n.h2,{id:"database-stack",children:"Database Stack"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"ORM:"})," Prisma (",(0,d.jsx)(n.code,{children:"@purplesector/db-prisma"}),")"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Dev database:"})," SQLite (",(0,d.jsx)(n.code,{children:"file:./dev.db"}),")"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Production:"})," PostgreSQL / TimescaleDB recommended"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Schema location:"})," ",(0,d.jsx)(n.code,{children:"packages/db-prisma/prisma/schema.prisma"})," (core) + ",(0,d.jsx)(n.code,{children:"schema.generated.prisma"})," (plugin models)"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"core-models",children:"Core Models"}),"\n",(0,d.jsx)(n.h3,{id:"event",children:"Event"}),"\n",(0,d.jsx)(n.p,{children:"Top-level container for organizing sessions (e.g., a track day or race weekend)."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"userId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Owner"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"name"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Event name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"description"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Optional description"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"location"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Track / venue"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"startDate"}),(0,d.jsx)(n.td,{children:"DateTime?"}),(0,d.jsx)(n.td,{children:"Event start"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"endDate"}),(0,d.jsx)(n.td,{children:"DateTime?"}),(0,d.jsx)(n.td,{children:"Event end"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"sessions"}),(0,d.jsx)(n.td,{children:"Session[]"}),(0,d.jsx)(n.td,{children:"Child sessions"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"session",children:"Session"}),"\n",(0,d.jsx)(n.p,{children:"A single driving stint within an event."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"userId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Owner"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"eventId"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Parent event"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"name"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Session name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"source"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Telemetry source (live, demo, etc.)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"status"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"recording, completed, etc."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"tags"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Comma-separated tags"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"laps"}),(0,d.jsx)(n.td,{children:"Lap[]"}),(0,d.jsx)(n.td,{children:"Child laps"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"lap",children:"Lap"}),"\n",(0,d.jsx)(n.p,{children:"A single lap within a session."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"sessionId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Parent session"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"lapNumber"}),(0,d.jsx)(n.td,{children:"Int"}),(0,d.jsx)(n.td,{children:"Lap number within session"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"lapTime"}),(0,d.jsx)(n.td,{children:"Float?"}),(0,d.jsx)(n.td,{children:"Lap time in seconds"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"telemetryFrames"}),(0,d.jsx)(n.td,{children:"TelemetryFrame[]"}),(0,d.jsx)(n.td,{children:"Raw telemetry data"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"telemetryframe",children:"TelemetryFrame"}),"\n",(0,d.jsx)(n.p,{children:"Individual time-ordered telemetry data points."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"interface TelemetryFrame {\n  timestamp: number;\n  throttle: number;           // 0.0 \u2013 1.0\n  brake: number;              // 0.0 \u2013 1.0\n  steering: number;           // -1.0 to 1.0\n  speed: number;              // km/h\n  gear: number;\n  rpm: number;\n  lapTime: number;            // milliseconds\n  lapNumber: number;\n  normalizedPosition: number; // 0.0 \u2013 1.0 (track position)\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"Collectors read this data from the game (UDP or shared memory) and encode it for transport (Kafka + Protobuf). The frontend consumes a decoded form over WebSockets."}),"\n",(0,d.jsx)(n.h3,{id:"vehicle",children:"Vehicle"}),"\n",(0,d.jsx)(n.p,{children:"Represents a racing vehicle."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"userId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Owner"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"name"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Vehicle name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"description"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Optional description"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"tags"}),(0,d.jsx)(n.td,{children:"Json?"}),(0,d.jsx)(n.td,{children:"Tags array"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"configurations"}),(0,d.jsx)(n.td,{children:"VehicleConfiguration[]"}),(0,d.jsx)(n.td,{children:"Parts lists"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"setups"}),(0,d.jsx)(n.td,{children:"VehicleSetup[]"}),(0,d.jsx)(n.td,{children:"Tuning parameter sets"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"vehicleconfiguration",children:"VehicleConfiguration"}),"\n",(0,d.jsx)(n.p,{children:"A named parts list for a vehicle."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"vehicleId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Parent vehicle"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"name"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Configuration name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"description"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Optional description"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"parts"}),(0,d.jsx)(n.td,{children:"Json"}),(0,d.jsx)(n.td,{children:"Key/value object of parts"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"vehiclesetup",children:"VehicleSetup"}),"\n",(0,d.jsx)(n.p,{children:"A named set of tuning parameters for a vehicle."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"vehicleId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Parent vehicle"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"configurationId"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Optional linked configuration"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"name"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Setup name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"description"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Optional description"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"parameters"}),(0,d.jsx)(n.td,{children:"Json"}),(0,d.jsxs)(n.td,{children:["Array of ",(0,d.jsx)(n.code,{children:"{ key, value, units }"})," objects"]})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"savedplotlayout",children:"SavedPlotLayout"}),"\n",(0,d.jsx)(n.p,{children:"Persisted plot layout configurations."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"userId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Owner"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"name"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Layout name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"description"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Optional description"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"configs"}),(0,d.jsx)(n.td,{children:"Json"}),(0,d.jsx)(n.td,{children:"Plot configurations"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"layout"}),(0,d.jsx)(n.td,{children:"Json"}),(0,d.jsx)(n.td,{children:"Grid layout information"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"isDefault"}),(0,d.jsx)(n.td,{children:"Boolean"}),(0,d.jsx)(n.td,{children:"Whether this is the default layout"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"mathtelemetrychannel",children:"MathTelemetryChannel"}),"\n",(0,d.jsx)(n.p,{children:"User-defined derived telemetry channels."}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"id"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Primary key"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"userId"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Owner"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"name"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Channel name"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"formula"}),(0,d.jsx)(n.td,{children:"String"}),(0,d.jsx)(n.td,{children:"Math expression"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"unit"}),(0,d.jsx)(n.td,{children:"String?"}),(0,d.jsx)(n.td,{children:"Display unit"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"plugin-models-agent",children:"Plugin Models (Agent)"}),"\n",(0,d.jsxs)(n.p,{children:["The agent plugin adds its own models via ",(0,d.jsx)(n.code,{children:"packages/plugin-agent/prisma/plugin.prisma"}),":"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"AgentConversation"})," \u2014 A chat conversation with the AI agent."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"AgentMessage"})," \u2014 Individual messages within a conversation (user and assistant)."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"RunPlan"})," \u2014 A proposed set of actions for user approval."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"RunPlanItem"})," \u2014 Individual steps within a run plan."]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["These are merged into the generated schema by ",(0,d.jsx)(n.code,{children:"scripts/merge-plugin-schemas.ts"}),"."]}),"\n",(0,d.jsx)(n.h2,{id:"schema-management",children:"Schema Management"}),"\n",(0,d.jsx)(n.h3,{id:"merging-plugin-schemas",children:"Merging Plugin Schemas"}),"\n",(0,d.jsx)(n.p,{children:"Plugin schemas are merged into a single generated file:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"npx ts-node scripts/merge-plugin-schemas.ts\n"})}),"\n",(0,d.jsxs)(n.p,{children:["This scans ",(0,d.jsx)(n.code,{children:"packages/plugin-*/prisma/plugin.prisma"})," and outputs ",(0,d.jsx)(n.code,{children:"packages/db-prisma/prisma/schema.generated.prisma"})," (gitignored)."]}),"\n",(0,d.jsx)(n.h3,{id:"common-commands",children:"Common Commands"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Command"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"npm run db:push"})}),(0,d.jsx)(n.td,{children:"Push schema changes to the database"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"npm run db:reset"})}),(0,d.jsx)(n.td,{children:"Reset the database (destructive \u2014 drops and recreates)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"npm run db:studio"})}),(0,d.jsx)(n.td,{children:"Open Prisma Studio for visual inspection"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"npm run db:check"})}),(0,d.jsx)(n.td,{children:"Scan for common issues (orphaned records, invalid references)"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Prefer creating events and sessions through the UI rather than manually in the DB."}),"\n",(0,d.jsxs)(n.li,{children:["When starting fresh in dev: reset DB, clear Next.js cache (",(0,d.jsx)(n.code,{children:"rm -rf .next/"}),"), then start dev servers."]}),"\n",(0,d.jsx)(n.li,{children:"Avoid deleting sessions/events while telemetry is actively streaming."}),"\n",(0,d.jsx)(n.li,{children:"In production, use PostgreSQL with proper connection pooling, backups, and monitoring."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"telemetry-pipeline",children:"Telemetry Pipeline"}),"\n",(0,d.jsx)(n.h3,{id:"kafka-transport",children:"Kafka Transport"}),"\n",(0,d.jsx)(n.p,{children:"In the Kafka pipeline, telemetry flows:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Collector"})," reads game data \u2192 serializes as Protobuf \u2192 publishes to Kafka topic."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"DB Consumer"})," subscribes to topic \u2192 batch-inserts frames \u2192 detects lap completions \u2192 persists laps."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"WS Bridge"})," subscribes to topic \u2192 decodes Protobuf \u2192 broadcasts to WebSocket clients."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"protobuf-encoding",children:"Protobuf Encoding"}),"\n",(0,d.jsxs)(n.p,{children:["Telemetry frames are encoded using Protocol Buffers for efficient binary transport. The schema lives in ",(0,d.jsx)(n.code,{children:"packages/proto/"}),". The frontend includes a generated decoder (",(0,d.jsx)(n.code,{children:"apps/web/src/proto/telemetry.js"}),") for client-side deserialization."]}),"\n",(0,d.jsx)(n.h3,{id:"per-user-topics",children:"Per-User Topics"}),"\n",(0,d.jsxs)(n.p,{children:["Each user gets a dedicated Kafka topic (",(0,d.jsx)(n.code,{children:"telemetry-user-<userId>"}),") for data isolation. See ",(0,d.jsx)(n.strong,{children:"Architecture \u2192 User Isolation"})," for details."]})]})}function x(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var r=s(6540);const d={},i=r.createContext(d);function t(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);