"use strict";(self.webpackChunkpurple_sector=self.webpackChunkpurple_sector||[]).push([[620],{4511:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"dev/analysis-panels","title":"Analysis Panels","description":"The analysis panel system powers the lap analysis view. It provides a configurable grid of panels where each panel is rendered by a plugin-provided AnalysisPanelProvider. This page covers the grid component, panel lifecycle, and how to create custom panel types.","source":"@site/docs/dev/analysis-panels.md","sourceDirName":"dev","slug":"/dev/analysis-panels","permalink":"/PurpleSector/dev/analysis-panels","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"userGuide","previous":{"title":"Plugins","permalink":"/PurpleSector/dev/plugins"},"next":{"title":"Database and Telemetry","permalink":"/PurpleSector/dev/database-and-telemetry"}}');var a=l(4848),i=l(8453);const r={},t="Analysis Panels",o={},d=[{value:"Overview",id:"overview",level:2},{value:"Key Components",id:"key-components",level:2},{value:"AnalysisPanelGrid",id:"analysispanelgrid",level:3},{value:"AnalysisPanelProvider",id:"analysispanelprovider",level:3},{value:"AnalysisPanelProps",id:"analysispanelprops",level:3},{value:"AnalysisHostAPI",id:"analysishostapi",level:3},{value:"Render Result",id:"render-result",level:3},{value:"Fullscreen Behavior",id:"fullscreen-behavior",level:2},{value:"Synced Hover",id:"synced-hover",level:2},{value:"Layout Persistence",id:"layout-persistence",level:2},{value:"Creating a Custom Panel Type",id:"creating-a-custom-panel-type",level:2},{value:"1. Register the Type and Provider",id:"1-register-the-type-and-provider",level:3},{value:"2. Implement the Panel Component",id:"2-implement-the-panel-component",level:3},{value:"3. Handle Synced Hover",id:"3-handle-synced-hover",level:3},{value:"Built-In Panel: Telemetry Plot",id:"built-in-panel-telemetry-plot",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"analysis-panels",children:"Analysis Panels"})}),"\n",(0,a.jsxs)(n.p,{children:["The analysis panel system powers the lap analysis view. It provides a configurable grid of panels where each panel is rendered by a plugin-provided ",(0,a.jsx)(n.code,{children:"AnalysisPanelProvider"}),". This page covers the grid component, panel lifecycle, and how to create custom panel types."]}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Analysis Toolbar (layout actions, save/load, etc.) \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Panel A               \u2502  Panel B                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 Toolbar (title,  \u2502  \u2502  \u2502 Toolbar (title,      \u2502  \u2502\n\u2502  \u2502 edit, fullscreen) \u2502  \u2502  \u2502 edit, fullscreen)    \u2502  \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502\n\u2502  \u2502                  \u2502  \u2502  \u2502                      \u2502  \u2502\n\u2502  \u2502  Chart content   \u2502  \u2502  \u2502  Chart content       \u2502  \u2502\n\u2502  \u2502                  \u2502  \u2502  \u2502                      \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Panel C (full width)                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 Toolbar + Chart content                      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(n.h2,{id:"key-components",children:"Key Components"}),"\n",(0,a.jsx)(n.h3,{id:"analysispanelgrid",children:"AnalysisPanelGrid"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"File:"})," ",(0,a.jsx)(n.code,{children:"apps/web/src/components/AnalysisPanelGrid.tsx"})]}),"\n",(0,a.jsx)(n.p,{children:"The grid component manages:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Panel layout"})," \u2014 A list of panel definitions with IDs, types, sizes, and optional state."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Fullscreen"})," \u2014 Any panel can be toggled to fill the entire grid area. The grid measures the available height via ",(0,a.jsx)(n.code,{children:"ResizeObserver"})," and passes it to the panel through ",(0,a.jsx)(n.code,{children:"host.availableHeight"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Layout actions"})," \u2014 Split horizontal, split vertical, remove panel."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Synced hover"})," \u2014 A shared hover value (e.g., time in seconds) is broadcast to all panels so they can highlight the same point."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Panel toolbar"})," \u2014 The grid renders a unified toolbar for each panel with the title (from the provider), edit button, fullscreen button, and layout actions."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"analysispanelprovider",children:"AnalysisPanelProvider"}),"\n",(0,a.jsx)(n.p,{children:"Plugins register providers that render panel content:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"interface AnalysisPanelProvider {\n  id: string;\n  typeId: string;        // e.g. 'plot'\n  isDefault?: boolean;\n  render: (props: AnalysisPanelProps) => AnalysisPanelRender;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"analysispanelprops",children:"AnalysisPanelProps"}),"\n",(0,a.jsx)(n.p,{children:"The grid passes these props to every provider:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"interface AnalysisPanelProps {\n  context: 'live' | 'singleLap' | 'lapComparison';\n  telemetry: TelemetryFrame[];\n  compareTelemetry?: TelemetryFrame[];\n  compareLapId?: string | null;\n  host: AnalysisHostAPI;\n  panelId?: string;\n  panelState?: unknown;\n  syncedHoverValue?: number | null;\n  onHoverChange?: (value: number | null) => void;\n  mathChannels?: MathTelemetryChannel[];\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"analysishostapi",children:"AnalysisHostAPI"}),"\n",(0,a.jsx)(n.p,{children:"The host API lets panels communicate back to the grid:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"interface AnalysisHostAPI {\n  setTitle?: (title: React.ReactNode) => void;\n  availableHeight?: number;  // Set when panel is fullscreen\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"render-result",children:"Render Result"}),"\n",(0,a.jsxs)(n.p,{children:["Providers can return either a plain ",(0,a.jsx)(n.code,{children:"React.ReactElement"})," or a structured result:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"interface AnalysisPanelRenderResult {\n  title?: React.ReactNode;\n  toolbarActions?: React.ReactNode;  // Rendered in the panel toolbar\n  content: React.ReactElement;       // Main body\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"This allows providers to inject custom toolbar actions (e.g., the edit/pencil button) while the grid handles fullscreen, layout actions, and positioning."}),"\n",(0,a.jsx)(n.h2,{id:"fullscreen-behavior",children:"Fullscreen Behavior"}),"\n",(0,a.jsx)(n.p,{children:"When a panel is toggled to fullscreen:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"The grid hides all other panels and expands the selected panel to fill the available area."}),"\n",(0,a.jsxs)(n.li,{children:["A ",(0,a.jsx)(n.code,{children:"ResizeObserver"})," measures the inner content wrapper's height."]}),"\n",(0,a.jsxs)(n.li,{children:["The measured height (minus ~130px for toolbar and chart chrome) is passed as ",(0,a.jsx)(n.code,{children:"host.availableHeight"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"The panel provider uses this height to size its chart correctly."}),"\n",(0,a.jsx)(n.li,{children:"Clicking the fullscreen button again (or pressing Escape) collapses back to the grid."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"synced-hover",children:"Synced Hover"}),"\n",(0,a.jsx)(n.p,{children:"All panels in the grid share a hover value:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["When the user hovers over a point in Panel A, the panel calls ",(0,a.jsx)(n.code,{children:"onHoverChange(timeValue)"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["The grid stores this value and passes it as ",(0,a.jsx)(n.code,{children:"syncedHoverValue"})," to all panels."]}),"\n",(0,a.jsx)(n.li,{children:"Each panel highlights the corresponding point on its chart."}),"\n",(0,a.jsxs)(n.li,{children:["When the mouse leaves, ",(0,a.jsx)(n.code,{children:"onHoverChange(null)"})," clears the highlight."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"layout-persistence",children:"Layout Persistence"}),"\n",(0,a.jsxs)(n.p,{children:["Panel arrangements are persisted as ",(0,a.jsx)(n.strong,{children:"analysis layouts"})," and ",(0,a.jsx)(n.strong,{children:"plot layouts"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Analysis layouts"})," \u2014 Which panels exist, their types, sizes, and positions."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Plot layouts"})," \u2014 Per-panel configuration (channels, axes, colors, title)."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"API routes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET/POST /api/analysis-layouts"})," \u2014 List and create analysis layouts."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET/PATCH/DELETE /api/analysis-layouts/[id]"})," \u2014 Manage individual layouts."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET/POST /api/plot-layouts"})," \u2014 List and create plot layouts."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET/PATCH/DELETE /api/plot-layouts/[id]"})," \u2014 Manage individual layouts."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET/POST /api/plot-layouts/default"})," \u2014 Get/set the default layout."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"creating-a-custom-panel-type",children:"Creating a Custom Panel Type"}),"\n",(0,a.jsx)(n.h3,{id:"1-register-the-type-and-provider",children:"1. Register the Type and Provider"}),"\n",(0,a.jsxs)(n.p,{children:["In your plugin's ",(0,a.jsx)(n.code,{children:"register()"})," function:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"ctx.registerAnalysisPanelType({\n  id: 'track-map',\n  label: 'Track Map',\n});\n\nctx.registerAnalysisPanelProvider({\n  id: 'core-track-map',\n  typeId: 'track-map',\n  isDefault: true,\n  render: (props) => ({\n    title: 'Track Map',\n    content: <TrackMapPanel {...props} />,\n  }),\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-implement-the-panel-component",children:"2. Implement the Panel Component"}),"\n",(0,a.jsxs)(n.p,{children:["Your component receives ",(0,a.jsx)(n.code,{children:"AnalysisPanelProps"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"function TrackMapPanel(props: AnalysisPanelProps) {\n  const { telemetry, compareTelemetry, host, syncedHoverValue } = props;\n\n  // Use host.availableHeight for fullscreen sizing\n  const height = host.availableHeight ?? 300;\n\n  return (\n    <div style={{ height }}>\n      {/* Render your visualization */}\n    </div>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-handle-synced-hover",children:"3. Handle Synced Hover"}),"\n",(0,a.jsx)(n.p,{children:"To participate in cross-panel hover synchronization:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"function TrackMapPanel(props: AnalysisPanelProps) {\n  const { syncedHoverValue, onHoverChange } = props;\n\n  // Highlight the point at syncedHoverValue\n  // Call onHoverChange(value) when the user hovers over your panel\n  // Call onHoverChange(null) when the mouse leaves\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"built-in-panel-telemetry-plot",children:"Built-In Panel: Telemetry Plot"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"plugin-core-lap-telemetry"})," plugin registers the ",(0,a.jsx)(n.code,{children:"plot"})," panel type with a provider that renders ",(0,a.jsx)(n.code,{children:"SimpleTelemetryPlotPanel"})," \u2192 ",(0,a.jsx)(n.code,{children:"ConfigurableTelemetryChart"})," (uPlot-based)."]}),"\n",(0,a.jsx)(n.p,{children:"Key features:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Channel selection (throttle, brake, steering, speed, RPM, gear, etc.)"}),"\n",(0,a.jsx)(n.li,{children:"Compare-lap overlay with dashed lines"}),"\n",(0,a.jsx)(n.li,{children:"Math channel support"}),"\n",(0,a.jsx)(n.li,{children:"Configurable axes and colors"}),"\n",(0,a.jsx)(n.li,{children:"Edit mode for changing plot configuration"}),"\n",(0,a.jsxs)(n.li,{children:["Fullscreen-aware sizing via ",(0,a.jsx)(n.code,{children:"host.availableHeight"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>t});var s=l(6540);const a={},i=s.createContext(a);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);